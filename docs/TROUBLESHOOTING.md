# 故障排除指南

本文档帮助您解决使用 MP Preview 插件时可能遇到的问题。

## 目录
1. [插件无法加载](#插件无法加载)
2. [预览面板问题](#预览面板问题)
3. [复制功能问题](#复制功能问题)
4. [样式问题](#样式问题)
5. [性能问题](#性能问题)

## 插件无法加载

### 症状
- 插件在设置列表中显示但无法启用
- 启用后立即自动禁用

### 解决方案

1. **检查文件完整性**
   确保插件目录包含以下文件：
   ```
   mp-preview/
   ├── main.js
   ├── manifest.json
   └── styles.css
   ```

2. **检查 Obsidian 版本**
   确保 Obsidian 版本 >= v0.15.0
   - 设置 → 关于 → 查看版本号

3. **重新安装插件**
   ```
   1. 关闭 Obsidian
   2. 删除 .obsidian/plugins/mp-preview 目录
   3. 重新安装插件
   4. 重启 Obsidian
   ```

## 预览面板问题

### 症状：预览面板空白

#### 检查清单
1. 确认打开的是 Markdown 文件（.md 扩展名）
2. 检查文件是否有内容
3. 查看开发者工具控制台（Ctrl+Shift+I 或 Cmd+Option+I）

#### 常见错误

**错误："Cannot read property 'styles' of undefined"**
- 原因：模板未正确加载
- 解决：重启 Obsidian 或重新安装插件

**错误："Cannot find module"**
- 原因：插件文件损坏
- 解决：重新下载安装插件

### 症状：预览不更新

1. 检查是否启用了锁定功能（🔒 图标）
2. 尝试点击锁定按钮解锁
3. 如果问题持续，尝试重新打开文件

## 复制功能问题

### 症状：复制按钮无反应

#### 检查步骤

1. **检查是否有内容**
   - 确保文档有内容
   - 预览面板显示正常

2. **检查剪贴板权限**
   - 某些浏览器/环境可能需要剪贴板权限
   - 尝试使用管理员权限运行 Obsidian（Windows）

3. **查看控制台错误**
   - 按 Ctrl+Shift+I 打开开发者工具
   - 查看 Console 标签页是否有红色错误

### 症状：复制后格式错乱

#### 可能原因

1. **CSS 样式未正确应用**
   - 某些邮件客户端或编辑器会过滤 CSS
   - 尝试使用不同的模板

2. **特殊字符问题**
   - 检查文档中是否有特殊 Unicode 字符
   - 尝试移除特殊字符后重新复制

3. **图片问题**
   - 本地图片可能无法正确复制
   - 建议将图片上传到图床

## 样式问题

### 症状：字体显示不正确

#### 中文字体问题

**问题**：选择了某种字体但显示为其他字体

**解决**：
1. 确保系统安装了该字体
2. 尝试重启 Obsidian
3. 清除 Obsidian 缓存（设置 → 关于 → 清除缓存）

### 症状：代码块样式异常

1. **代码块头部不显示**
   - 确保代码块使用了正确的语法标记
   - 例如：```javascript 而不是 ```

2. **语法高亮失效**
   - 检查是否标记了正确的语言
   - 支持的语言列表参考 Obsidian 文档

### 症状：表格样式错乱

- 表格过宽：调整字号或使用更简单的表格
- 表格线不显示：某些模板可能隐藏表格边框，尝试切换模板

## 性能问题

### 症状：大文件预览卡顿

#### 优化建议

1. **启用锁定功能**
   - 编辑大文件时点击 🔒 锁定预览
   - 完成编辑后再解锁查看效果

2. **分段编辑**
   - 将大文档分成多个小文件编辑
   - 使用 Obsidian 的嵌入功能组合

3. **关闭实时预览**
   - 如果不需要实时预览，可以关闭预览面板
   - 编辑完成后再打开预览

### 症状：内存占用高

1. **限制图片数量**
   - 大量高清图片会占用大量内存
   - 考虑压缩图片或使用外部图床

2. **定期重启 Obsidian**
   - 长时间使用可能导致内存泄漏
   - 建议定期重启应用

## 收集诊断信息

如果以上方法都无法解决问题，请收集以下信息提交到 GitHub Issues：

1. **Obsidian 版本**：设置 → 关于
2. **插件版本**：设置 → 第三方插件 → MP Preview
3. **操作系统版本**
4. **控制台错误信息**：
   - Ctrl+Shift+I 打开开发者工具
   - Console 标签页的红色错误信息
5. **复现步骤**

## 联系方式

- GitHub Issues: https://github.com/li-xiu-qi/mp-preview/issues
- 提交问题时请附上诊断信息
